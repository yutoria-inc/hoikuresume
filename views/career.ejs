<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>保育士転職 職務経歴書自動作成</title>
    <meta
      name="description"
      content="保育士転職向けの職務経歴書をWeb上で自動作成し、PDFでダウンロードできます。"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }

     :root {
      --primary: #0f766e;
      --primary-soft: #e0f2f1;
      --accent: #0f766e;
      --border: #e5e7eb;
      --bg: #f3f4f6;
      --card-bg: #ffffff;
      --text-main: #111827;
      --text-sub: #6b7280;
      --danger: #ef4444;
    }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI',
          sans-serif;
        margin: 0 auto;
        padding: 24px 16px 40px;
        background: radial-gradient(circle at top left, #eef2ff 0, #f3f4f6 40%, #f9fafb 100%);
        color: var(--text-main);
      }

      /* 共通ヘッダー */
      .site-header {
        display: flex;
        align-items: center;
        height: 56px;
        margin-bottom: 24px;
      }
      .site-header a {
        color: var(--text-main);
        text-decoration: none;
      }
      .site-header a:hover {
        color: var(--text-main);
        text-decoration: none;
      }
      .site-logo {
        font-weight: 700;
        font-size: 20px;
        letter-spacing: 0.12em;
        display: inline-block;
        padding: 6px 4px;
      }

    /* ページコンテナ */
    .page {
      border-radius: 18px;
      padding: 28px 24px 32px;
      background: var(--card-bg);
      box-shadow:
        0 20px 45px rgba(15, 23, 42, 0.10),
        0 1px 0 rgba(255, 255, 255, 0.6) inset;
      max-width: 1200px;   /* ★ ここを追加（お好みで 1200〜1300 くらい） */
      margin: 0 auto;  
    }

    .page-title {
      font-size: 22px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 18px;
      letter-spacing: 0.04em;
    }

      /* ───────── ステッパー ───────── */

    .stepper-container {
      margin-bottom: 20px;
    }

    .stepper-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-sub);
    }

    .stepper {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      padding: 10px 12px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 999px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .stepper::before {
      content: '';
      position: absolute;
      left: 40px;
      right: 40px;
      top: 24px;
      height: 2px;
      background: linear-gradient(90deg, #e5e7eb, #e5e7eb);
      z-index: 0;
    }

    .step {
      position: relative;
      z-index: 1;
      flex: 1;
      text-align: center;
      min-width: 0;
      cursor: pointer;
    }

    .step-circle {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      margin: 0 auto 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      border: 2px solid #d1d5db;
      background: #f9fafb;
      color: #9ca3af;
      transition: 0.18s ease;
    }

    .step-label {
      font-size: 11px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #9ca3af;
      transition: 0.18s ease;
    }

    .step--active .step-circle {
      border-color: var(--primary);
      background: var(--primary-soft);
      color: var(--primary);
      font-weight: 600;
      transform: translateY(-1px);
    }

    .step--active .step-label {
      color: var(--primary);
      font-weight: 600;
    }

    .step--completed .step-circle {
      border-color: var(--primary);
      background: var(--primary);
      color: #fff;
    }

    .step--completed .step-label {
      color: var(--primary);
    }

      /* ───────── モバイル切り替えタブ ───────── */

      .view-toggle {
        margin: 16px 0 12px;
        display: flex;
        justify-content: center;
      }
      .view-toggle-inner {
        display: inline-flex;
        border-radius: 999px;
        border: 1px solid var(--border);
        overflow: hidden;
        background: #fff;
      }
      .view-toggle-btn {
        padding: 6px 14px;
        font-size: 13px;
        border: none;
        background: transparent;
        cursor: pointer;
        color: var(--text-sub);
      }
      .view-toggle-btn.is-active {
        background: var(--primary-soft);
        color: var(--primary);
        font-weight: 600;
      }
      @media (min-width: 900px) {
        .view-toggle {
          display: none;
        }
      }

      /* ───────── レイアウト ───────── */

      .layout {
        display: flex;
        gap: 16px;
        align-items: flex-start;
      }
      .preview-pane,
      .form-pane {
        background: #fff;
        border-radius: 12px;
        padding: 16px 18px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.04);
      }

      @media (min-width: 900px) {
        .preview-pane {
          flex: 2;
          min-width: 0;
        }
        .form-pane {
          flex: 1;
          min-width: 0;
        }
        .layout.show-form .form-pane,
        .layout.show-form .preview-pane,
        .layout.show-preview .form-pane,
        .layout.show-preview .preview-pane {
          display: block;
        }
      }

      @media (max-width: 899px) {
        .layout {
          flex-direction: column;
        }
        .preview-pane,
        .form-pane {
          width: 100%;
          margin: 0 0 16px;
        }
        .layout.show-form .form-pane {
          display: block;
        }
        .layout.show-form .preview-pane {
          display: none;
        }
        .layout.show-preview .preview-pane {
          display: block;
        }
        .layout.show-preview .form-pane {
          display: none;
        }
      }

      /* ───────── 職務経歴書プレビュー ───────── */
      .preview-card-wrapper {
        border: 1px solid #e2e2e2;
        border-radius: 8px;
        background: #ffffff;
        position: relative;
        overflow: hidden;

        /* ★ A4縦の比率：幅 : 高さ = 1 : √2 ≒ 1 : 1.414 */
        aspect-ratio: 1 / 1.4142;
      }

      /* ★ モバイル用：A4固定サイズ + スクロール表示 */
      @media (max-width: 899px) {
        .preview-pane {
          /* プレビュー領域にスクロールバーを出す */
          overflow: auto;
        }

        .preview-card-wrapper {
          /* A4 相当サイズ（px は好みで調整OK） */
          width: 794px;                 /* おおよそ A4 の幅 */
          height: calc(794px * 1.4142); /* A4 縦：1 : √2 */
          max-width: none;

          /* もともとの aspect-ratio を無効にする */
          aspect-ratio: auto;

          margin: 0 auto 0;             /* 中央寄せしたければ */
        }
      }

      /* こっちが中身（本文） */
      .preview-card {
        position: absolute;
        inset: 18px 20px;  /* もともとの padding 相当 */
        font-size: 12px;
        line-height: 1.6;
        overflow: auto;    /* ★ 中身がはみ出すときはスクロール */
        box-sizing: border-box;
        border: none;
        background: transparent;
      }

      .preview-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
      }
      .preview-sub {
        font-size: 11px;
        color: var(--text-sub);
        margin-bottom: 12px;
      }

      .jis-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 4px;
      }

      .jis-title {
        font-size: 22px;
        font-weight: 700;
        letter-spacing: 0.1em;
      }

      .jis-meta {
        text-align: right;
        font-size: 13px;
        line-height: 1.4;
        margin-bottom: 8px;
      }

      .jis-date {
        font-size: 10px;
        text-align: right;
        white-space: nowrap;
      }
      .jis-divider {
        border-bottom: 3px double #333;
        margin: 6px 0 12px;
      }

      .jis-section {
        margin-bottom: 16px;
      }
      .jis-section-heading {
        font-size: 16px;
        font-weight: 600;
        text-align: center;
        border-bottom: 1px solid #333;
        padding-bottom: 2px;
        margin-bottom: 6px;
      }
      .jis-row {
        display: flex;
        font-size: 11.5px;
        margin-bottom: 3px;
      }
      .jis-label {
        width: 80px;
        flex-shrink: 0;
      }
      .jis-value {
        flex: 1;
        min-height: 1.2em;
        border-bottom: 0.5px solid #ccc;
      }
      .jis-multiline-box {
        min-height: 60px;
        padding: 6px 8px;
      }
      .preview-empty {
        color: #bbb;
        font-style: italic;
      }

      /* ───────── フォーム共通 ───────── */

      .form-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
      }
      form {
        margin: 0;
      }
      .step-section {
        display: none;
      }
      .step-section.is-active {
        display: block;
      }
      .field {
        margin-bottom: 14px;
      }
      label,
      .field-label {
        display: block;
        font-size: 13px;
        margin: 0 0 4px;
      }
      input[type='text'],
      input[type='email'],
      input[type='tel'],
      input[type='date'],
      textarea {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        font-size: 14px;
      }
      textarea {
        min-height: 80px;
        resize: vertical;
      }

      .nav-buttons {
        margin-top: 16px;
        display: flex;
        justify-content: space-between;
        gap: 8px;
        align-items: center;
      }
      .btn {
        padding: 9px 18px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
      }
      .btn-prev {
        background: #eee;
        color: #555;
      }
      .btn-next {
        background: var(--primary);
        color: #fff;
      }
      .btn-submit {
        background: var(--accent);
        color: #fff;
      }
      .btn-prev[disabled] {
        opacity: 0.5;
        cursor: default;
      }

      .skill-row {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
      }

      .skill-input-left {
        flex: 0 0 45%;
      }

      .skill-input-right {
        flex: 1;
      }

      .career-item {
        background: #ffffff;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 18px;
      }

      .career-period-row {
        display: flex;
        gap: 14px;
      }

      /* モバイル：園児数・職員数を縦並びにする */
      @media (max-width: 899px) {
        .career-period-row {
          flex-direction: column;
          gap: 8px;
        }
      }

      .career-divider {
        margin-top: 20px;
        border: none;
        border-bottom: 1px solid #ccc;
      }

      #add-career-btn {
        margin-top: 10px;
      }

      .note {
        font-size: 11px;
        color: var(--text-sub);
        margin-top: 8px;
      }

      .career-preview-header {
        display: flex;
        justify-content: space-between;
        background: #eee;
        padding: 6px 10px;
        font-size: 11.5px;
        border-radius: 4px;
      }
      
      .career-preview-title {
        font-weight: 600;
        font-size: 12px;
        margin-top: 6px;
        display: flex;
        gap: 4px;
      }

      .career-preview-title .label {
        color: #333;
        font-weight: 600;
      }

      .career-preview-detail {
        font-size: 11.5px;
        margin-top: 2px;
        line-height: 1.5;
      }

      .pr-checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-bottom: 14px;
      }
      .pr-checkbox-group label {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
      }
      .generate-pr-btn {
        margin-top: 4px;
        margin-bottom: 12px;
        padding: 8px 12px;
        background: var(--primary);
        color: #fff;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-size: 14px;
      }
      .generate-pr-btn:hover {
        opacity: 0.85;
      }

      /* PDF生成中だけ A4比率制約を外す */
      body.pdf-mode .preview-card-wrapper {
        aspect-ratio: auto;
        height: auto;
      }

      body.pdf-mode .preview-card {
        position: static;
        inset: auto;
        height: auto;
        overflow: visible;
      }

    </style>
  </head>
  <body>
    <!-- 共通ヘッダー -->
    <header class="site-header">
      <a href="/">
        <div class="site-logo">ホイクレジュメ</div>
      </a>
    </header>

    <!-- ステップバー -->
    <div class="stepper-container">
      <div class="stepper-title">保育士 職務経歴書</div>
      <div class="stepper" id="stepper">
        <div class="step step--active" data-step="1">
          <div class="step-circle">1</div>
          <div class="step-label">経歴要約</div>
        </div>
        <div class="step" data-step="2">
          <div class="step-circle">2</div>
          <div class="step-label">スキル</div>
        </div>
        <div class="step" data-step="3">
          <div class="step-circle">3</div>
          <div class="step-label">職務経歴</div>
        </div>
        <div class="step" data-step="4">
          <div class="step-circle">4</div>
          <div class="step-label">自己PR</div>
        </div>
        <div class="step" data-step="5">
          <div class="step-circle">5</div>
          <div class="step-label">確認</div>
        </div>
      </div>
    </div>

    <main class="page">
      <h1 class="page-title">職務経歴書を作成する</h1>

    <!-- モバイル：入力 / プレビュー切り替え -->
    <div class="view-toggle">
      <div class="view-toggle-inner">
        <button
          type="button"
          class="view-toggle-btn is-active"
          data-view="form"
        >
          入力画面
        </button>
        <button
          type="button"
          class="view-toggle-btn"
          data-view="preview"
        >
          プレビュー画面
        </button>
      </div>
    </div>

    <!-- メインレイアウト -->
    <div class="layout show-form" id="layout">
      <!-- プレビュー -->
      <div class="preview-pane">
        <div class="preview-title">職務経歴書プレビュー</div>
        <div class="preview-sub">
          このプレビューとほぼ同じレイアウトでPDFが作成されます。
          <span id="page-count-indicator" style="margin-left:8px;"></span>
        </div>

        <div class="preview-card-wrapper">
          <div class="preview-card">
            <div class="jis-header">
              <div class="jis-title">職務経歴書</div>
            </div>

            <div class="jis-divider"></div>

            <div class="jis-meta">
              <div id="pv-date"></div>
              <div id="pv-name-top"></div>
            </div>

            <div class="jis-section">
              <div class="jis-section-heading">職務要約</div>
              <div class="jis-multiline-box">
                <span id="pv-summary" class="preview-empty">
                  （ここに経歴要約が入ります）
                </span>
              </div>
            </div>

            <div class="jis-section">
              <div class="jis-section-heading">資格・スキル</div>

              <div class="jis-multiline-box">
                <div id="pv-skill-wrapper">
                  <span class="preview-empty">（未入力）</span>
                </div>
              </div>
            </div>

            <div class="jis-section">
              <div class="jis-section-heading">職務経歴</div>

              <div id="pv-career-wrapper"></div>
            </div>

            <div class="jis-section">
              <div class="jis-section-heading">自己PR</div>
              <div class="jis-multiline-box">
                <span id="pv-prText" class="preview-empty">
                  （ここに自己PR・志望動機が入ります）
                </span>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- 入力フォーム -->
      <div class="form-pane">
        <div class="form-title" id="form-title">
          経歴要約（氏名・職務要約）を入力
        </div>

        <form action="/career/generate" method="POST" id="career-form">
          <!-- STEP 1: 経歴要約 -->
          <div class="step-section is-active" data-step="1">
            <div class="field">
              <label>氏名</label>
              <div style="display:flex; gap:8px;">
                <div style="flex:1;">
                  <input
                    type="text"
                    id="lastName"
                    name="lastName"
                    placeholder="姓"
                    required
                  />
                </div>
                <div style="flex:1;">
                  <input
                    type="text"
                    id="firstName"
                    name="firstName"
                    placeholder="名"
                    required
                  />
                </div>
              </div>
              <!-- バックエンド用にフルネームを hidden で保持 -->
              <input type="hidden" id="name" name="name" />
            </div>

            <!-- 経歴要約：選択肢＋自動生成 -->
            <div class="field">
              <label for="summary">経歴要約（ご自由に書き換えて下さい）</label>

              <p class="note">
                当てはまる項目を選択すると、自動で経歴要約文を作成できます。（あとから自由に編集できます）
              </p>

              <div class="pr-checkbox-group" style="margin-bottom:8px;">
                <!-- 経験年数・働き方 -->
                <label>
                  <input
                    type="checkbox"
                    class="summary-option"
                    value="保育士として複数の園で勤務し、乳児から幼児まで幅広い年齢の子どもたちを担当してきました。"
                  />
                  複数園・幅広い年齢を担当
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="summary-option"
                    value="主に0〜2歳児クラスを担当し、基本的生活習慣の自立と情緒の安定を大切にした保育を行ってきました。"
                  />
                  0〜2歳児クラス中心
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="summary-option"
                    value="3〜5歳児クラスを中心に担任として勤務し、集団生活のなかでの主体性・協調性を育む保育に取り組んできました。"
                  />
                  3〜5歳児クラス中心
                </label>

                <!-- 役割・ポジション -->
                <label>
                  <input
                    type="checkbox"
                    class="summary-option"
                    value="クラス担任として日常保育に加え、行事運営や書類作成、保護者対応まで一貫して担当してきました。"
                  />
                  クラス担任経験あり
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="summary-option"
                    value="フリー保育士として複数クラスのサポートに入り、職員同士で協力しながら保育環境の安定に努めてきました。"
                  />
                  フリー保育士としての経験
                </label>

                <!-- 強みの方向性 -->
                <label>
                  <input
                    type="checkbox"
                    class="summary-option"
                    value="保護者との連絡帳や面談を通じて丁寧なコミュニケーションを心がけ、信頼関係の構築に力を入れてきました。"
                  />
                  保護者対応が得意
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="summary-option"
                    value="年間行事や制作活動の企画・準備・当日運営に主体的に携わり、チームでの行事運営を経験してきました。"
                  />
                  行事・制作が得意
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="summary-option"
                    value="加配児・支援児の担当も経験し、一人ひとりの特性に合わせた関わり方を意識して保育を行ってきました。"
                  />
                  加配・支援児の経験あり
                </label>
              </div>

              <button
                type="button"
                id="generateSummary"
                class="generate-pr-btn"
                style="margin-bottom:8px;"
              >
                選択内容から経歴要約を自動生成する
              </button>

              <textarea
                id="summary"
                name="summary"
                rows="6"
                placeholder="例：保育士として〇年勤務し、〇〇保育園にて0〜5歳児クラスを経験してきました。クラス担任として保護者対応や行事運営も担当し、チームで協力しながら子どもたちが安心して過ごせる環境づくりに取り組んできました。"
              ></textarea>
            </div>
          </div>
          
          <!-- STEP 2: 活かせるスキル・経験 -->
          <div class="step-section" data-step="2">
            <p class="note">
              「保有資格」と「スキル」にチェックをつけると、左のプレビューに自動で文章が反映されます。
            </p>

            <!-- 保有資格 -->
            <div class="field">
              <div class="field-label">保有資格・免許</div>

              <div style="margin-bottom:8px; font-size:12px; color:var(--text-sub);">
                ▼ 国家資格・公的資格
              </div>

              <!-- 保育士 -->
              <div style="border:1px solid #eee; border-radius:8px; padding:10px 12px; margin-bottom:10px;">
                <label style="display:flex; align-items:center; gap:6px; font-size:14px;">
                  <input type="checkbox" id="q-hoikushi" class="qual-checkbox" data-label="保育士" />
                  保育士
                </label>

                <div style="margin-top:8px; padding-left:22px; font-size:13px;">
                  <div style="margin-bottom:6px;">
                    取得年月：
                    <div style="display:flex; gap:6px; align-items:center;">
                      <input
                        type="number"
                        id="q-hoikushi-year"
                        placeholder="年"
                        min="1950"
                        max="2100"
                        style="width:80px; font-size:13px;"
                      />
                      <span>年</span>

                      <select
                        id="q-hoikushi-month"
                        style="font-size:13px;"
                      >
                        <option value="">月</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                      </select>
                      <span>月</span>
                    </div>
                  </div>

                  <div style="display:flex; flex-direction:column; gap:3px;">
                    <span>状態：</span>
                    <label>
                      <input
                        type="radio"
                        name="q-hoikushi-status"
                        value="done"
                        class="qual-radio"
                      />
                      取得済
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="q-hoikushi-status"
                        value="plan"
                        class="qual-radio"
                      />
                      取得見込み（取得見込み年月は上記に入力）
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="q-hoikushi-status"
                        value="study"
                        class="qual-radio"
                      />
                      勉強中
                    </label>
                  </div>
                </div>
              </div>

              <!-- その他の資格（チェックのみ） -->
              <div class="pr-checkbox-group" style="margin-top:6px;">
                <label>
                  <input
                    type="checkbox"
                    class="qual-checkbox"
                    data-label="幼稚園教諭二種免許"
                  />
                  幼稚園教諭二種免許
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="qual-checkbox"
                    data-label="幼稚園教諭一種免許"
                  />
                  幼稚園教諭一種免許
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="qual-checkbox"
                    data-label="児童指導員"
                  />
                  児童指導員
                </label>
                <label>
                  <input
                    type="checkbox"
                    id="q-jidou-hattatsu"
                    class="qual-checkbox"
                    data-label="児童発達支援管理責任者"
                  />
                  児童発達支援管理責任者
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="qual-checkbox"
                    data-label="社会福祉士"
                  />
                  社会福祉士
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="qual-checkbox"
                    data-label="看護師"
                  />
                  看護師
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="qual-checkbox"
                    data-label="栄養士"
                  />
                  栄養士
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="qual-checkbox"
                    data-label="無資格"
                  />
                  無資格
                </label>
              </div>
            </div>

            <!-- スキル -->
            <div class="field" style="margin-top:18px;">
              <div class="field-label">スキル</div>
              <div class="pr-checkbox-group">
                <label>
                  <input
                    type="checkbox"
                    class="skill-checkbox"
                    data-label="ピアノなど音楽系のスキル"
                  />
                  ピアノなど音楽系のスキル
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="skill-checkbox"
                    data-label="リトミック、運動系のスキル"
                  />
                  リトミック、運動系のスキル
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="skill-checkbox"
                    data-label="手遊びや制作系のスキル"
                  />
                  手遊びや制作系のスキル
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="skill-checkbox"
                    data-label="障がい児保育の経験"
                  />
                  障がい児保育の経験
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="skill-checkbox"
                    data-label="保護者の子育て相談の経験"
                  />
                  保護者の子育て相談の経験
                </label>
                <label>
                  <input
                    type="checkbox"
                    class="skill-checkbox"
                    data-label="Word（文書作成）などPCスキル"
                  />
                  Word（文書作成）などPCスキル
                </label>
              </div>
            </div>
          </div>

          <!-- STEP 3: 職務経歴 -->
          <div class="step-section" data-step="3">
            <p class="note">
              1園ごとに入力してください。（「＋勤務先を追加」で複数園を追加できます）
            </p>

            <div id="career-list">

              <!-- 1園目 -->
              <div class="career-item">

                <!-- 園名 -->
                <div class="field">
                  <label>園名（勤務先）</label>
                  <input
                    type="text"
                    name="company[]"
                    class="career-company"
                    placeholder="例：〇〇〇保育園"
                  />
                </div>

                <!-- 期間・雇用形態 -->
                <div class="field career-period-row">
                  <div>
                    <label>入職年月</label>
                    <div style="display:flex; gap:6px; align-items:center;">
                      <input
                        type="number"
                        class="career-start-year"
                        placeholder="年"
                        min="1950"
                        max="2100"
                        style="width:80px;"
                      />
                      <span>年</span>

                      <select class="career-start-month">
                        <option value="">月</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                      </select>
                      <span>月</span>
                    </div>
                  </div>

                  <div>
                    <label>退職年月</label>
                      <div style="display:flex; gap:6px; align-items:center;">
                        <input
                          type="number"
                          class="career-end-year"
                          placeholder="年"
                          min="1950"
                          max="2100"
                          style="width:80px;"
                        />
                        <span>年</span>

                        <select class="career-end-month">
                          <option value="">月</option>
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>
                          <option value="4">4</option>
                          <option value="5">5</option>
                          <option value="6">6</option>
                          <option value="7">7</option>
                          <option value="8">8</option>
                          <option value="9">9</option>
                          <option value="10">10</option>
                          <option value="11">11</option>
                          <option value="12">12</option>
                        </select>
                        <span>月</span>
                      </div>
                  </div>

                  <div style="display:flex; align-items:center; gap:6px;">
                    <input type="checkbox" name="current[]" class="career-current" />
                    <label>現在も勤務中</label>
                  </div>
                </div>

                <div class="field">
                  <label>雇用形態</label>
                  <select name="employment_type[]" class="career-employment">
                    <option value="">選択してください</option>
                    <option value="正社員">正社員</option>
                    <option value="パート">パート</option>
                    <option value="派遣">派遣</option>
                    <option value="契約社員">契約社員</option>
                  </select>
                </div>

                <!-- 園の種類・規模 -->
                <div class="field">
                  <label>園の種類</label>
                  <select name="facility_type[]" class="career-facility-type">
                    <option value="">選択してください</option>
                    <option value="認可">認可</option>
                    <option value="認証">認証</option>
                    <option value="小規模">小規模</option>
                    <option value="企業内">企業内</option>
                    <option value="院内">院内</option>
                    <option value="認定こども園">認定こども園</option>
                  </select>
                </div>

                <div class="field career-period-row">
                  <div>
                    <label>園児数</label>
                    <input
                      type="number"
                      name="children_count[]"
                      class="career-children"
                      placeholder="例：100"
                    />
                  </div>
                  <div>
                    <label>職員数</label>
                    <input
                      type="number"
                      name="staff_count[]"
                      class="career-staff"
                      placeholder="例：30"
                    />
                  </div>
                </div>

                <!-- 担当業務 -->
                <div class="field">
                  <label>担当業務（ご自由に書き換えて下さい）</label>

                  <div class="pr-checkbox-group responsibility-checkbox-group">
                    <!-- クラス・年齢 -->
                    <label>
                      <input
                        type="checkbox"
                        class="responsibility-option"
                        data-text="0〜2歳児クラスの担任"
                      />
                      0〜2歳児クラスの担任
                    </label>
                    <label>
                      <input
                        type="checkbox"
                        class="responsibility-option"
                        data-text="3〜5歳児クラスの担任"
                      />
                      3〜5歳児クラスの担任
                    </label>
                    <label>
                      <input
                        type="checkbox"
                        class="responsibility-option"
                        data-text="複数クラスへのフリー保育士としてのサポート"
                      />
                      フリー保育士として複数クラスをサポート
                    </label>

                    <!-- シフト・生活面 -->
                    <label>
                      <input
                        type="checkbox"
                        class="responsibility-option"
                        data-text="早番・遅番シフト対応"
                      />
                      早番・遅番シフト対応
                    </label>
                    <label>
                      <input
                        type="checkbox"
                        class="responsibility-option"
                        data-text="午睡・食事・排泄など基本的生活習慣の援助"
                      />
                      午睡・食事・排泄など生活面の援助
                    </label>

                    <!-- 書類・保護者 -->
                    <label>
                      <input
                        type="checkbox"
                        class="responsibility-option"
                        data-text="連絡帳・おたより・園だより等の作成"
                      />
                      連絡帳・おたより等の作成
                    </label>
                    <label>
                      <input
                        type="checkbox"
                        class="responsibility-option"
                        data-text="保護者との連絡・面談対応"
                      />
                      保護者との連絡・面談対応
                    </label>

                    <!-- その他 -->
                    <label>
                      <input
                        type="checkbox"
                        class="responsibility-option"
                        data-text="行事準備や制作物の準備・片付け"
                      />
                      行事準備・制作物の準備
                    </label>
                    <label>
                      <input
                        type="checkbox"
                        class="responsibility-option"
                        data-text="園内環境整備や安全点検"
                      />
                      園内環境整備・安全点検
                    </label>
                  </div>

                  <button type="button" class="generate-pr-btn generate-responsibility-btn">
                    選択内容から担当業務を自動生成
                  </button>

                  <textarea
                    name="responsibility[]"
                    rows="3"
                    class="career-responsibility"
                    placeholder="例：
  ・0〜2歳児クラスの担任
  ・早番・遅番シフト対応
  ・連絡帳・おたより作成 など"
                  ></textarea>
                </div>


                <!-- 職務内容（カテゴリ＋自動生成） -->
                <div class="field">
                  <label>職務内容（ご自由に書き換えて下さい）</label>

                  <div class="career-category-group" style="font-size:13px; margin-bottom:6px;">
                    <label><input type="checkbox" class="duty-category" data-text="日々の保育実践（基本的生活習慣の援助や遊びの見守りなど）"> 日常保育</label>
                    <label><input type="checkbox" class="duty-category" data-text="指導計画・保育日誌などの書類作成"> 書類・計画</label>
                    <label><input type="checkbox" class="duty-category" data-text="年間行事・季節行事の企画・準備・当日運営"> 行事運営</label>
                    <label><input type="checkbox" class="duty-category" data-text="連絡帳や面談を通じた保護者対応"> 保護者対応</label>
                    <label><input type="checkbox" class="duty-category" data-text="加配児・支援児への個別配慮"> 支援・加配</label>
                    <label><input type="checkbox" class="duty-category" data-text="職員間での情報共有・後輩職員のサポート"> チーム運営</label>
                    <label><input type="checkbox" class="duty-category" data-text="ICTシステムやPCを用いた記録・事務作業"> ICT・事務</label>
                  </div>

                  <button type="button" class="generate-pr-btn generate-duty-btn">
                    カテゴリから職務内容を自動生成
                  </button>

                  <textarea
                    name="duty_detail[]"
                    rows="4"
                    class="career-duty-detail"
                    placeholder="例：
  ・日々の保育実践に加え
  ・行事でのピアノ演奏
  ・リトミック指導
  ・各種書類作成"
                  ></textarea>
                </div>

                <!-- 退職理由 -->
                <div class="field">
                  <label>退職理由（任意）（ご自由に書き換えて下さい）</label>
                  <p class="note">
                    当てはまる項目を選択すると、退職理由文を自動で作成できます。（あとから自由に書き換えOK）
                  </p>

                  <div class="pr-checkbox-group retire-checkbox-group">
                    <label>
                      <input
                        type="checkbox"
                        class="retire-option"
                        data-text="家庭の事情による転居のため、やむを得ず退職いたしました。"
                      />
                      実家・配偶者の転居のため
                    </label>
                    <label>
                      <input
                        type="checkbox"
                        class="retire-option"
                        data-text="契約期間の満了に伴い、退職いたしました。"
                      />
                      契約満了のため
                    </label>
                    <label>
                      <input
                        type="checkbox"
                        class="retire-option"
                        data-text="新たな環境で経験の幅を広げたいと考え、退職いたしました。"
                      />
                      スキルアップ・環境を変えるため
                    </label>
                    <label>
                      <input
                        type="checkbox"
                        class="retire-option"
                        data-text="体調面を優先する必要があり、一度退職という形を選択いたしました。"
                      />
                      体調・家庭事情を優先するため
                    </label>
                    <label>
                      <input
                        type="checkbox"
                        class="retire-option"
                        data-text="園の方針とは尊重し合いながらも、目指す保育観に違いを感じたため、退職いたしました。"
                      />
                      園の方針との違いを感じたため
                    </label>
                  </div>

                  <button type="button" class="generate-pr-btn generate-retire-btn">
                    選択内容から退職理由を自動生成
                  </button>

                  <textarea
                    name="reason[]"
                    rows="2"
                    class="career-reason"
                    placeholder="例：実家のある地域への転居に伴い退職。"
                  ></textarea>
                </div>

                <hr class="career-divider" />
              </div>

            </div>

            <!-- 追加ボタン -->
            <button type="button" id="add-career-btn" class="generate-pr-btn">
              ＋ 勤務先を追加
            </button>
          </div>

          <!-- STEP 4: 自己PR（選択肢＋自動生成） -->
          <div class="step-section" data-step="4">

            <p class="field-label">当てはまる項目を選択してください（複数選択可）</p>
            <div class="pr-checkbox-group">
              <label
                ><input
                  type="checkbox"
                  class="pr-option"
                  value="子ども一人ひとりの気持ちに寄り添い、安心して過ごせる雰囲気づくりを大切にしてきました。"
                />
                子どもへの寄り添い</label
              >
              <label
                ><input
                  type="checkbox"
                  class="pr-option"
                  value="保護者とのコミュニケーションを丁寧に行い、信頼関係の構築に努めてきました。"
                />
                保護者との連携</label
              >
              <label
                ><input
                  type="checkbox"
                  class="pr-option"
                  value="行事や制作活動の企画・準備・当日運営まで主体的に取り組んできました。"
                />
                行事・制作活動が得意</label
              >
              <label
                ><input
                  type="checkbox"
                  class="pr-option"
                  value="0〜2歳児クラスの経験が豊富で、発達段階に合わせた保育を心がけています。"
                />
                0〜2歳児の経験</label
              >
              <label
                ><input
                  type="checkbox"
                  class="pr-option"
                  value="急なシフト変更やトラブルにも落ち着いて対応し、チームで解決にあたってきました。"
                />
                柔軟な対応力・協調性</label
              >
              <label
                ><input
                  type="checkbox"
                  class="pr-option"
                  value="新しい保育方法や研修にも積極的に参加し、学んだことを現場で実践してきました。"
                />
                学び続ける姿勢</label
              >
            </div>

            <button
              id="generatePR"
              type="button"
              class="generate-pr-btn"
            >
              選択内容から自己PR文を自動生成する
            </button>

            <p class="field-label">自己PR・志望動機（編集もOK）</p>
            <textarea
              id="prText"
              name="pr"
              rows="6"
              placeholder="自動生成ボタンを押すと、ここに自己PR文が入ります。気になる部分は自由に書き換えてください。"
            ></textarea>
          </div>

          <!-- STEP 5: 確認・PDF -->
          <div class="step-section" data-step="5">
            <p
              style="
                font-size: 13px;
                color: var(--text-sub);
                line-height: 1.6;
              "
            >
              入力内容は左側のプレビューに反映されています。<br />
              内容を確認し、問題なければ「PDFをダウンロード」を押してください。
            </p>
            <p class="note">
              ※テスト版のため、入力内容はサーバーに保存されません（PDF生成のみに利用されます）。
            </p>
          </div>

          <!-- ナビゲーションボタン -->
          <div class="nav-buttons">
            <button
              type="button"
              class="btn btn-prev"
              id="btn-prev"
            >
              ＜ 前へ
            </button>

            <div style="margin-left: auto; display: flex; gap: 8px">
              <button
                type="button"
                class="btn btn-next"
                id="btn-next"
              >
                次へ ＞
              </button>
              <button
                type="submit"
                class="btn btn-submit"
                id="btn-submit"
                style="display: none"
              >
                PDFをダウンロード
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
    </main>

    <script>
      // ───── ステップ制ロジック ─────
      const totalSteps = 5;
      let currentStep = 1;

      const stepSections = document.querySelectorAll('.step-section');
      const stepElems = document.querySelectorAll('#stepper .step');
      const prevBtn = document.getElementById('btn-prev');
      const nextBtn = document.getElementById('btn-next');
      const submitBtn = document.getElementById('btn-submit');
      const formTitle = document.getElementById('form-title');

      const stepTitles = {
        1: '経歴要約（氏名・職務要約）を入力',
        2: '資格・スキルを入力',
        3: '職務経歴（勤務先企業・職務内容）を入力',
        4: '自己PR・志望動機を入力',
        5: '内容確認・PDFダウンロード',
      };

      function showStep(step) {
        currentStep = step;

        stepSections.forEach((sec) => {
          const s = parseInt(sec.dataset.step, 10);
          sec.classList.toggle('is-active', s === currentStep);
        });

        if (formTitle) {
          formTitle.textContent = stepTitles[currentStep] || '';
        }

        stepElems.forEach((el) => {
          const s = parseInt(el.dataset.step, 10);
          el.classList.remove('step--active', 'step--completed');
          if (s < currentStep) el.classList.add('step--completed');
          else if (s === currentStep) el.classList.add('step--active');
        });

        if (currentStep === 1) {
          prevBtn.disabled = true;
        } else {
          prevBtn.disabled = false;
        }

        if (currentStep === totalSteps) {
          nextBtn.style.display = 'none';
          submitBtn.style.display = 'inline-block';
        } else {
          nextBtn.style.display = 'inline-block';
          submitBtn.style.display = 'none';
        }
      }

      prevBtn.addEventListener('click', () => {
        if (currentStep > 1) showStep(currentStep - 1);
      });
      nextBtn.addEventListener('click', () => {
        if (currentStep < totalSteps) showStep(currentStep + 1);
      });
      stepElems.forEach((el) => {
        el.addEventListener('click', () => {
          const targetStep = parseInt(el.dataset.step, 10);
          if (!Number.isNaN(targetStep)) showStep(targetStep);
        });
      });
      showStep(1);

      // ───── モバイル：入力 / プレビュー切り替え ─────
      const layoutEl = document.getElementById('layout');
      const viewToggleBtns = document.querySelectorAll('.view-toggle-btn');

      viewToggleBtns.forEach((btn) => {
        btn.addEventListener('click', () => {
          const view = btn.dataset.view; // 'form' or 'preview'

          // ボタンの見た目を更新
          viewToggleBtns.forEach((b) => b.classList.remove('is-active'));
          btn.classList.add('is-active');

          // レイアウトの表示を切り替え
          if (view === 'form') {
            layoutEl.classList.add('show-form');
            layoutEl.classList.remove('show-preview');
          } else if (view === 'preview') {
            layoutEl.classList.add('show-preview');
            layoutEl.classList.remove('show-form');
          }
        });
      });


      // ───── PDF ダウンロード（職務経歴書） ─────
      const careerForm = document.getElementById('career-form');

      if (careerForm) {
        careerForm.addEventListener('submit', function (e) {
          e.preventDefault(); // 通常のPOST送信を止める

          const layout = document.getElementById('layout');
          const element = document.querySelector('.preview-pane .preview-card-wrapper'); // ★ ここ変更

          if (!element) {
            alert('プレビューが見つかりません。');
            return;
          }

          // モバイルの場合でもプレビューを確実に表示
          if (layout) {
            layout.classList.add('show-preview');
            layout.classList.remove('show-form');
          }

          const opt = {
            margin: [5, 5, 5, 5], // mm
            filename: 'shokumu-keirekisho.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
          };

          // ★ PDFモードON
          document.body.classList.add('pdf-mode');

          html2pdf()
            .set(opt)
            .from(element)
            .save()
            .then(() => {
              // ★ PDFモードOFF
              document.body.classList.remove('pdf-mode');
            })
            .catch(() => {
              document.body.classList.remove('pdf-mode');
            });
        });
      }


      // ───── プレビューのリアルタイム反映 ─────
      function bindText(inputId, previewId, defaultText) {
        const input = document.getElementById(inputId);
        const preview = document.getElementById(previewId);
        if (!input || !preview) return;

        const base = defaultText || preview.textContent || '未入力';
        preview.dataset.default = base;

        const update = () => {
          const v = input.value.trim();
          if (v) {
            preview.textContent = v;
            preview.classList.remove('preview-empty');
          } else {
            preview.textContent = preview.dataset.default;
            preview.classList.add('preview-empty');
          }
        };

        input.addEventListener('input', update);
        update();
      }

      bindText('skill1-left', 'pv-skill1-left', '（未入力）');
      bindText('skill1-right', 'pv-skill1-right', '（未入力）');
      bindText('skill2-left', 'pv-skill2-left', '（未入力）');
      bindText('skill2-right', 'pv-skill2-right', '（未入力）');
      bindText('skill3-left', 'pv-skill3-left', '（未入力）');
      bindText('skill3-right', 'pv-skill3-right', '（未入力）');
      bindText('summary', 'pv-summary', '（ここに経歴要約が入ります）');
      bindText(
        'history',
        'pv-history',
        '（ここに勤務先企業・職務内容が入ります）'
      );
      bindText(
        'prText',
        'pv-prText',
        '（ここに自己PR・志望動機が入ります）'
      );

      // ───── 氏名（姓＋名）プレビュー反映 ─────
      const lastInput = document.getElementById('lastName');
      const firstInput = document.getElementById('firstName');
      const hiddenName = document.getElementById('name');
      const pvNameTop = document.getElementById('pv-name-top');

      function updateNamePreview() {
        if (!pvNameTop) return;

        const last = (lastInput?.value || '').trim();
        const first = (firstInput?.value || '').trim();

        let display = '';
        if (last && first) {
          // ★姓と名の間に半角スペース 1 個
          display = `${last} ${first}`;
        } else if (last || first) {
          display = last || first;
        }

        // hidden の name にも同じ値を入れておく（サーバー送信用）
        if (hiddenName) {
          hiddenName.value = display;
        }

        if (display) {
          pvNameTop.textContent = display;
          pvNameTop.classList.remove('preview-empty');
        } else {
          pvNameTop.textContent = '';
          pvNameTop.classList.add('preview-empty');
        }
      }

      if (lastInput) lastInput.addEventListener('input', updateNamePreview);
      if (firstInput) firstInput.addEventListener('input', updateNamePreview);
      updateNamePreview();


      // ───── 資格・スキル：プレビュー反映 ─────

      // 西暦 → 和暦（ざっくり）に変換する関数
      function toWareki(ym) {
        if (!ym) return "";

        const [yStr, mStr] = ym.split("-");
        const y = parseInt(yStr, 10);
        const m = parseInt(mStr, 10);

        let era = "";
        let n = 0;

        if (y >= 2019) {
          era = "令和";
          n = y - 2018;
        } else if (y >= 1989) {
          era = "平成";
          n = y - 1988;
        } else {
          // それ以前はとりあえず西暦表示
          return `${y}年${m}月`;
        }

        const yearStr = n === 1 ? "元" : String(n);
        return `${era}${yearStr}年${m}月`;
      }

      function updateSkillExperiencePreview() {
        const wrapper = document.getElementById("pv-skill-wrapper");
        if (!wrapper) return;

        wrapper.innerHTML = "";

        const qualLines = [];
        const skillLines = [];

        // 保育士
        const hoikushiCheckbox = document.getElementById("q-hoikushi");
        if (hoikushiCheckbox && hoikushiCheckbox.checked) {
          const y = document.getElementById("q-hoikushi-year")?.value;
          const m = document.getElementById("q-hoikushi-month")?.value;

          // ★★ 保育士の取得年月は「西暦」で表示 ★★
          let dateStr = "";
          if (y && m) {
            dateStr = `${y}年${m}月`;
          }

          const status = document.querySelector(
            'input[name="q-hoikushi-status"]:checked'
          )?.value;

          let line = "";

          if (status === "done") {
            line = dateStr ? `${dateStr}　保育士資格 取得` : "保育士資格 取得";
          } else if (status === "plan") {
            line = dateStr
              ? `${dateStr}　保育士資格 取得見込み`
              : "保育士資格 取得見込み";
          } else if (status === "study") {
            line = "現在、保育士資格の取得に向けて勉強中です。";
          } else {
            // 状態未選択の場合は、とりあえず資格名だけ
            line = "保育士資格";
          }

          // ★ 資格も箇条書きにしたいので「・」を付けて push
          qualLines.push(`・${line}`);
        }

        // その他資格（児童発達支援管理責任者だけ特別文章）
        document.querySelectorAll(".qual-checkbox").forEach((cb) => {
          if (!cb.checked) return;
          if (cb.id === "q-hoikushi") return; // 保育士は上で処理済み

          const label = cb.dataset.label || "";

          if (cb.id === "q-jidou-hattatsu") {
            qualLines.push("・現在、児童発達支援管理責任者の資格取得に向けて勉強中です。");
          } else if (label) {
            qualLines.push(`・${label}`);
          }
        });

        // スキル
        document.querySelectorAll(".skill-checkbox").forEach((cb) => {
          if (!cb.checked) return;
          const label = cb.dataset.label || "";
          if (label) {
            skillLines.push(`・${label}`);
          }
        });

        // 何も選択されていない場合
        if (!qualLines.length && !skillLines.length) {
          const span = document.createElement("span");
          span.className = "preview-empty";
          span.textContent = "（未入力）";
          wrapper.appendChild(span);
          return;
        }

        // 【資格】ブロック
        if (qualLines.length) {
          const title = document.createElement("div");
          title.textContent = "【資格】";
          title.style.fontWeight = "600";
          wrapper.appendChild(title);

          qualLines.forEach((line) => {
            const div = document.createElement("div");
            div.textContent = line;
            wrapper.appendChild(div);
          });

          // 間を少し空ける
          const space = document.createElement("div");
          space.style.height = "6px";
          wrapper.appendChild(space);
        }

        // 【スキル】ブロック
        if (skillLines.length) {
          const title = document.createElement("div");
          title.textContent = "【スキル】";
          title.style.fontWeight = "600";
          wrapper.appendChild(title);

          skillLines.forEach((line) => {
            const div = document.createElement("div");
            div.textContent = line;
            wrapper.appendChild(div);
          });
        }
        updatePageCountIndicator();
      }


      document.addEventListener("change", (e) => {
        const target = e.target;
        if (
          target.classList.contains("qual-checkbox") ||
          target.classList.contains("qual-radio") ||
          target.classList.contains("skill-checkbox") ||
          target.id === "q-hoikushi-year" ||
          target.id === "q-hoikushi-month"
        ) {
          updateSkillExperiencePreview();
        }
      });

      // 初期表示
      updateSkillExperiencePreview();

      // ───── 経歴要約：選択肢から自動生成 ─────
      const generateSummaryBtn = document.getElementById('generateSummary');
      const summaryTextarea = document.getElementById('summary');
      const summaryOptions = document.querySelectorAll('.summary-option');

      if (generateSummaryBtn && summaryTextarea) {
        generateSummaryBtn.addEventListener('click', () => {
          const checked = Array.from(summaryOptions).filter((o) => o.checked);

          if (!checked.length) {
            alert('まず当てはまる項目を1つ以上選択してください。');
            return;
          }

          const parts = checked.map((o) => o.value);

          const text =
            '保育士としてのこれまでの経験では、' +
            parts.join(' ') +
            ' これらの経験を通じて、子ども一人ひとりに寄り添いながら、保護者・職員と協力して安心して過ごせる保育環境づくりに取り組んできました。';

          summaryTextarea.value = text;
          // プレビュー(pv-summary)を更新させる
          summaryTextarea.dispatchEvent(new Event('input'));
        });
      }


      // ───── 自己PR：選択肢から自動生成 ─────
      const generateBtn = document.getElementById('generatePR');
      const prTextarea = document.getElementById('prText');
      const prOptions = document.querySelectorAll('.pr-option');

      if (generateBtn && prTextarea) {
        generateBtn.addEventListener('click', () => {
          const checked = Array.from(prOptions).filter((o) => o.checked);
          if (!checked.length) {
            alert('まず当てはまる項目を1つ以上選択してください。');
            return;
          }

          const parts = checked.map((o) => o.value);
          const text =
            'これまでの保育士としての経験の中で、' +
            parts.join(' ') +
            ' といった点を大切にしてまいりました。' +
            '貴園でも子どもたち一人ひとりに寄り添いながら、保護者や職員の方々と協力し、安心して過ごせる環境づくりに貢献したいと考えております。';

          prTextarea.value = text;
          prTextarea.dispatchEvent(new Event('input'));
        });
      }

      // ───── 職務経歴：追加ボタン ─────
      const addCareerBtn = document.getElementById("add-career-btn");
      const careerList = document.getElementById("career-list");

      if (addCareerBtn && careerList) {
        addCareerBtn.addEventListener("click", () => {
          const base = careerList.querySelector(".career-item");
          if (!base) return;

          const item = base.cloneNode(true);

          // 入力値を全部クリア
          item.querySelectorAll("input, textarea, select").forEach((el) => {
            if (el.type === "checkbox" || el.type === "radio") {
              el.checked = false;
            } else {
              el.value = "";
            }
          });

          careerList.appendChild(item);
          updateCareerPreview();
        });
      }

      // ───── 職務内容：カテゴリから自動生成 ─────
      document.addEventListener("click", (e) => {
        const btn = e.target;
        if (!btn.classList.contains("generate-duty-btn")) return;

        const item = btn.closest(".career-item");
        if (!item) return;

        const checked = item.querySelectorAll(".duty-category:checked");
        if (!checked.length) {
          alert("まずカテゴリを1つ以上選択してください。");
          return;
        }

        const parts = Array.from(checked).map(
          (c) => "・" + (c.dataset.text || "")
        );

        const text = parts.join("\n");

        const textarea = item.querySelector(".career-duty-detail");
        if (textarea) {
          textarea.value = text;

          // ① inputイベントをバブリングさせる
          textarea.dispatchEvent(new Event("input", { bubbles: true }));

          // ② 念のためプレビュー関数を直叩き（どっちかだけでも動くけど安心のダブル）
          updateCareerPreview();
        }
      });

      // ───── 担当業務：選択肢から自動生成 ─────
      document.addEventListener("click", (e) => {
        const btn = e.target;
        if (!btn.classList.contains("generate-responsibility-btn")) return;

        const item = btn.closest(".career-item");
        if (!item) return;

        const checked = item.querySelectorAll(".responsibility-option:checked");
        if (!checked.length) {
          alert("まず当てはまる項目を1つ以上選択してください。");
          return;
        }

        const parts = Array.from(checked)
          .map((c) => c.dataset.text || "")
          .filter(Boolean);

        // ★ 1行ずつ「・」から始まる箇条書きにする
        const text = parts.map((p) => `・${p}`).join("\n");

        const textarea = item.querySelector(".career-responsibility");
        if (textarea) {
          textarea.value = text;

          // プレビュー更新用に input イベントをバブリングさせる
          textarea.dispatchEvent(new Event("input", { bubbles: true }));

          // 念のため直接も呼んでおく
          updateCareerPreview();
        }
      });

      // ───── 退職理由：選択肢から自動生成 ─────
      document.addEventListener("click", (e) => {
        const btn = e.target;
        if (!btn.classList.contains("generate-retire-btn")) return;

        const item = btn.closest(".career-item");
        if (!item) return;

        const checked = item.querySelectorAll(".retire-option:checked");
        if (!checked.length) {
          alert("まず当てはまる項目を1つ以上選択してください。");
          return;
        }

        const parts = Array.from(checked)
          .map((c) => c.dataset.text || "")
          .filter(Boolean);

        const text = parts.join(" ");

        const textarea = item.querySelector(".career-reason");
        if (textarea) {
          textarea.value = text;

          // 入力イベントをバブリングさせてプレビュー更新
          textarea.dispatchEvent(new Event("input", { bubbles: true }));

          // 念のため直接呼ぶ
          updateCareerPreview();
        }
      });

      function updateCareerPreview() {
        const wrapper = document.getElementById("pv-career-wrapper");
        if (!wrapper) return;

        wrapper.innerHTML = "";

        const items = document.querySelectorAll(".career-item");
        if (!items.length) {
          const span = document.createElement("span");
          span.className = "preview-empty";
          span.textContent = "（勤務先・職務内容が未入力です）";
          wrapper.appendChild(span);
          return;
        }

        items.forEach((item) => {
          const company = item.querySelector(".career-company")?.value.trim();

          const sy = item.querySelector(".career-start-year")?.value;
          const sm = item.querySelector(".career-start-month")?.value;
          const start = sy && sm ? `${sy}-${String(sm).padStart(2, "0")}` : "";

          const ey = item.querySelector(".career-end-year")?.value;
          const em = item.querySelector(".career-end-month")?.value;
          const end = ey && em ? `${ey}-${String(em).padStart(2, "0")}` : "";

          const current = item.querySelector(".career-current")?.checked;

          const employment = item.querySelector(".career-employment")?.value;
          const facilityType = item.querySelector(".career-facility-type")?.value;
          const children = item.querySelector(".career-children")?.value;
          const staff = item.querySelector(".career-staff")?.value;
          const responsibility = item
            .querySelector(".career-responsibility")
            ?.value.trim();
          const dutyDetail = item
            .querySelector(".career-duty-detail")
            ?.value.trim();
          const reason = item.querySelector(".career-reason")?.value.trim();

          const jpStart = start ? toWareki(start) : "";
          const jpEnd = end ? toWareki(end) : "";

          const block = document.createElement("div");
          block.style.marginBottom = "14px";
          block.style.fontSize = "11.5px";
          block.style.lineHeight = "1.6";

          // 令和5年◯月 〇〇〇保育園 入職
          if (jpStart || company) {
            const line1 = document.createElement("div");
            line1.textContent =
              (jpStart ? jpStart + "　" : "") +
              (company || "（勤務先未入力）") +
              "　入職";
            block.appendChild(line1);
          }

          // <雇用形態>正社員
          if (employment) {
            const line2 = document.createElement("div");
            line2.textContent = `<雇用形態>${employment}`;
            block.appendChild(line2);
          }

          // <園の種類・規模>認可保育園　園児数：100人 職員数：30人
          if (facilityType || children || staff) {
            const line3 = document.createElement("div");
            let text = "<園の種類・規模>";
            if (facilityType) {
              const kind =
                facilityType === "認定こども園"
                  ? "認定こども園"
                  : facilityType + "保育園";
              text += kind;
            }
            const parts = [];
            if (children) parts.push(`園児数：${children}人`);
            if (staff) parts.push(`職員数：${staff}人`);
            if (parts.length) text += "　" + parts.join(" ");
            line3.textContent = text;
            block.appendChild(line3);
          }

          // <担当業務> 箇条書き
          if (responsibility) {
            const title = document.createElement("div");
            title.textContent = "<担当業務>";
            block.appendChild(title);

            responsibility.split("\n").forEach((row) => {
              if (!row.trim()) return;
              const li = document.createElement("div");
              li.textContent = row;          // 中身は「・〜」まで含めたテキスト
              li.style.paddingLeft = "1em";  // 職務内容と同じくインデント
              block.appendChild(li);
            });
          }

          // <職務内容> 箇条書き
          if (dutyDetail) {
            const title = document.createElement("div");
            title.textContent = "<職務内容>";
            block.appendChild(title);

            dutyDetail.split("\n").forEach((row) => {
              if (!row.trim()) return;
              const li = document.createElement("div");
              li.textContent = row;
              li.style.paddingLeft = "1em";
              block.appendChild(li);
            });
          }

          // 退職行
          if (!current && jpEnd) {
            const line6 = document.createElement("div");
            line6.style.marginTop = "4px";
            if (reason) {
              // 令和7年◯月　実家の移住に伴い退職
              line6.textContent = `${jpEnd}　${reason}`;
            } else {
              line6.textContent = `${jpEnd}　退職`;
            }
            block.appendChild(line6);
          }

          wrapper.appendChild(block);
        });

        updatePageCountIndicator();
      }

      // 入力イベントと紐づける
      document.addEventListener("input", updateCareerPreview);

      // ───── 日付（職務経歴書の日付） ─────
      const dateEl = document.getElementById('pv-date');
      if (dateEl) {
        const d = new Date();
        const y = d.getFullYear();
        const m = d.getMonth() + 1;
        const day = d.getDate();
        dateEl.textContent = `${y}年${m}月${day}日現在`;
      }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

  </body>
</html>
